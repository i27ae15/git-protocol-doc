<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-git-protocol/ref-delta" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">5. Parsing REF_DELTA | Git-protocol</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://i2ae15.github.io/git-protocol-doc/img/octopus.jpeg"><meta data-rh="true" name="twitter:image" content="https://i2ae15.github.io/git-protocol-doc/img/octopus.jpeg"><meta data-rh="true" property="og:url" content="https://i2ae15.github.io/git-protocol-doc/docs/git-protocol/ref-delta"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="5. Parsing REF_DELTA | Git-protocol"><meta data-rh="true" name="description" content="It&#x27;s time to talk about a new object, the REF_DELTA; this objects objective is designed to minimize storage requirements by referencing existing data instead of storing duplicate content."><meta data-rh="true" property="og:description" content="It&#x27;s time to talk about a new object, the REF_DELTA; this objects objective is designed to minimize storage requirements by referencing existing data instead of storing duplicate content."><link data-rh="true" rel="icon" href="/git-protocol-doc/img/octopus.jpeg"><link data-rh="true" rel="canonical" href="https://i2ae15.github.io/git-protocol-doc/docs/git-protocol/ref-delta"><link data-rh="true" rel="alternate" href="https://i2ae15.github.io/git-protocol-doc/docs/git-protocol/ref-delta" hreflang="en"><link data-rh="true" rel="alternate" href="https://i2ae15.github.io/git-protocol-doc/docs/git-protocol/ref-delta" hreflang="x-default"><link rel="stylesheet" href="/git-protocol-doc/assets/css/styles.561c5ca7.css">
<script src="/git-protocol-doc/assets/js/runtime~main.7249cdfc.js" defer="defer"></script>
<script src="/git-protocol-doc/assets/js/main.450917ee.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/git-protocol-doc/img/octopus.jpeg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/git-protocol-doc/"><div class="navbar__logo"><img src="/git-protocol-doc/img/octopus.jpeg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/git-protocol-doc/img/octopus.jpeg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Git Protocol</b></a><a class="navbar__item navbar__link" href="/git-protocol-doc/docs/objects/blob">Objects</a><a class="navbar__item navbar__link" href="/git-protocol-doc/docs/git-protocol/intro">Git-Protocol</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/i27ae15/git-protocol-doc" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Doc Repository<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/git-protocol-doc/docs/git-protocol/intro">git-protocol</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/git-protocol-doc/docs/git-protocol/intro">GIT-Protocol</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/git-protocol-doc/docs/git-protocol/discovering-references">1. Discovering References</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/git-protocol-doc/docs/git-protocol/git-upload">2. Git-Upload Service</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/git-protocol-doc/docs/git-protocol/pack-header">3. Pack Header</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/git-protocol-doc/docs/git-protocol/object-header">4. Object Header</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/git-protocol-doc/docs/git-protocol/ref-delta">5. Parsing REF_DELTA</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/git-protocol-doc/docs/git-protocol/reading-pack-file">6. Reading Pack File</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/git-protocol-doc/docs/objects/blob">objects</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><span class="breadcrumbs__link">git-protocol</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">5. Parsing REF_DELTA</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>5. Parsing REF_DELTA</h1></header>
<p>It&#x27;s time to talk about a new object, the <code>REF_DELTA</code>; this objects objective is designed to minimize storage requirements by referencing existing data instead of storing duplicate content.</p>
<p>First, let&#x27;s understand how the <code>REF_DELTA</code> object is structured:</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="ref_delta-structure">REF_DELTA Structure<a href="#ref_delta-structure" class="hash-link" aria-label="Direct link to REF_DELTA Structure" title="Direct link to REF_DELTA Structure">​</a></h2>
<p>Taking out the object header, the <code>REF_DELTA</code> body is separated in 3 parts:</p>
<ol>
<li><strong>SHA1 Reference:</strong> The SHA1 that is the reference to the object we want to work with (in raw bytes).</li>
<li><strong>Source and Target Size:</strong> Specifies the sizes of the referenced object (source) and the final object after applying the delta (target).</li>
<li><strong>Instructions:</strong> A series of <code>COPY</code> and <code>ADD</code> commands that reconstruct the object from the referenced data.</li>
</ol>
<p>Here is an example of a <code>REF_DELTA</code> object:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&lt; bytes &gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">49 a6 dd 7a 7f 92 b9 42 53 49 d3 78 49 a3 29 49 f9 92 93 a9</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt; bytes &gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt; z_lib compressed &gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">30 03 - Encoded source size: 0x30.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">50 01 - Encoded target size: 0x50.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...............................................................................</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c0 00 04     - COPY</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">12 34 ab cd  - ADD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt; z_lib compressed &gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Les see one by one:</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="part-1-sha1-reference">Part 1: SHA1 Reference<a href="#part-1-sha1-reference" class="hash-link" aria-label="Direct link to Part 1: SHA1 Reference" title="Direct link to Part 1: SHA1 Reference">​</a></h3>
<p>This is just the SHA1 that the <code>REF_DELTA</code> is referencing, so, in other words, this is
what tells us which object we want to take the data from.</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>This SHA1 could be referencing a Blob, Commit or Tree object.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="part-2-source-and-target-size">Part 2: Source and Target Size<a href="#part-2-source-and-target-size" class="hash-link" aria-label="Direct link to Part 2: Source and Target Size" title="Direct link to Part 2: Source and Target Size">​</a></h3>
<p>The source size represents the size of the referenced object, while the target size is the size of the object after applying all the <code>COPY</code> and <code>ADD</code> instructions.</p>
<p>Both sizes are encoded similarly to the size in an object header, the only difference
is that the size is withing bits <code>6-0</code>, not <code>3-0</code> and still, the MSB indicates
continuation, the steps are the same:</p>
<ol>
<li>Extracts bits <code>6-0</code>.</li>
<li>Combine them to the size.</li>
<li>Check for the MSB to see if the next byte is part of the current size.</li>
<li>In case it is, shift the necessary bits by <code>7N</code> where <code>N</code> first value is <code>0</code>.</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="part-3-instructions">Part 3: Instructions<a href="#part-3-instructions" class="hash-link" aria-label="Direct link to Part 3: Instructions" title="Direct link to Part 3: Instructions">​</a></h3>
<p>In a <code>REF_DELTA</code> object we have two type of instructions:</p>
<ol>
<li><strong>COPY:</strong> Copies data from the referenced object based on a specified offset and size.</li>
<li><strong>ADD:</strong> Inserts literal data into the object.</li>
</ol>
<p>Where the first bit indicates the type of the command, <code>1</code> for <code>COPY</code>, <code>0</code> for <code>ADD</code>.</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>Have in mind that there could be many <code>COPY</code> or many <code>ADD</code> command together, for example</p></div></div>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">            This is valid:  | This is also valid | And also this is valid</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               `COPY`                `COPY`                 `ADD`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               `ADD`                 `COPY`                 `ADD`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               `COPY`                `COPY`                 `ADD`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               `ADD`                 `ADD`                  `COPY`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               .....                 .....                  .....</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="copy">COPY<a href="#copy" class="hash-link" aria-label="Direct link to COPY" title="Direct link to COPY">​</a></h4>
<p>This instructions tell us to go to the file referenced by the SHA1 and <code>COPY X</code> values from it starting at <code>OFFSET Y</code>, the
encoding goes as follow</p>
<ul>
<li><strong>Bits 6-4:</strong> Specify the size to copy.</li>
<li><strong>Bits 3-0:</strong> Specify where to start copying (offset).</li>
</ul>
<p>The bits indicates the number of bytes that correspond to the offset (max of 4 bytes) and the bytes that are part of the size, and also the amount to be shifted by. This sounds complicated but is not. Let me explain:</p>
<p>Let&#x27;s say we have the byte <code>\xD6</code> which in binary equals <code>1101 0110</code>, the first thing to do is to check the MSB to see if this
is equal to <code>1</code> or <code>0</code> (or check if the byte is bigger than <code>127</code>), which in this case, we easily see that it equals to <code>1</code>
indicating a <code>COPY</code> command, so let&#x27;s parse the bits <code>6 - 4</code> that indicate the size.</p>
<p>By checking at bits <code>6 - 4</code> we get the following value <code>101</code>, telling us that the following 2 bytes are part of the size, other
examples for the bits <code>6 - 4</code> could be:</p>
<ul>
<li><code>100</code> : The following byte is part of the size.</li>
<li><code>010</code> : The following byte is part of the size.</li>
<li><code>001</code> : The following byte is part of the size.</li>
<li><code>011</code> : The following 2 bytes are part of the size.</li>
<li><code>111</code> : The following 3 bytes are part of the size.</li>
</ul>
<p>Now, I guess you are wondering &quot;Well what is the difference between the first three examples? The three of them are saying that
only the next byte is part of the size. Or what is the difference between <code>011</code> and <code>101</code> they both seem to indicate that the next
2 bytes are part of the size&quot;.</p>
<p>The answer to this questions is &quot;the position refers to the shifting of that byte&quot;:</p>
<ul>
<li><code>100</code> : The following byte is part of the size.</li>
<li><code>010</code> : The following byte is part of the size &amp; should be shifted by <code>8</code>.</li>
<li><code>001</code> : The following byte is part of the size &amp; should be shifted by <code>16</code>.</li>
</ul>
<p>And the same goes for two or three 1s and for the offset as well. This allows GIT to be able to make copies from files as big as
<code>4,294,967,295</code> (max value for <code>32uint_t</code>) characters long or about <code>~4 GB</code>, in chunks of max <code>16,777,215</code> characters which is
<code>~16 MB</code>.</p>
<p>Following our example where we have <code>101</code>, two bytes for the size, and <code>0110</code>, two bytes for the offset:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">NEXT_BYES :  BYTE_0 (SIZE)  -  BYTE_1 (SIZE)  -  BYTE_2 (OFFSET)  -  BYTE_3(OFFSET)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               SHIFT(16)         NO_SHIFT           SHIFT(16)           SHIFT(8)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Once having this, we are good to start copy from the indicated <code>offset</code> until the indicated <code>size</code>.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="add">ADD<a href="#add" class="hash-link" aria-label="Direct link to ADD" title="Direct link to ADD">​</a></h4>
<p>The <code>ADD</code> command is pretty straight forward, we just need to read the lower 7 bits (a maximum of 127 characters) which are the size of the content to copy, content that start on the next byte.
Let’s say you encounter this in the delta stream:</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="breakdown">Breakdown:<a href="#breakdown" class="hash-link" aria-label="Direct link to Breakdown:" title="Direct link to Breakdown:">​</a></h5>
<ol>
<li>
<p><strong>Tag Byte <code>7F</code>:</strong></p>
<ul>
<li>MSB = <code>0</code> → Indicates an <code>ADD</code> command.</li>
<li>Lower 7 bits = <code>0x7F</code> → Specifies that <strong>127 literal bytes</strong> follow this tag.</li>
</ul>
</li>
<li>
<p><strong>Literal Bytes:</strong></p>
<ul>
<li>Immediately after the tag byte, 127 bytes of data are added.</li>
<li>For example:<!-- -->
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">48 65 6C 6C 6F 20 77 6F 72 6C 64 21</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>Interpreted as ASCII: <code>Hello world!</code></li>
</ul>
</li>
</ul>
</li>
</ol>
<p>If you need to add more than <strong>127 bytes</strong> of literal data, Git uses <strong>multiple consecutive <code>ADD</code> commands</strong>. For example:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">7F &lt;127 bytes of data&gt; 7F &lt;127 bytes of data&gt; ...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="key-points">Key Points:<a href="#key-points" class="hash-link" aria-label="Direct link to Key Points:" title="Direct link to Key Points:">​</a></h4>
<ul>
<li>Each <code>ADD</code> command is limited to <strong>127 bytes</strong> because the tag byte only has 7 bits to encode the length.</li>
<li>For larger additions, split the data into chunks, each preceded by its own <code>ADD</code> tag.</li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/i27ae15/git-protocol-doc/docs/git-protocol/ref-delta.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/git-protocol-doc/docs/git-protocol/object-header"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">4. Object Header</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/git-protocol-doc/docs/git-protocol/reading-pack-file"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">6. Reading Pack File</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#ref_delta-structure" class="table-of-contents__link toc-highlight">REF_DELTA Structure</a><ul><li><a href="#part-1-sha1-reference" class="table-of-contents__link toc-highlight">Part 1: SHA1 Reference</a></li><li><a href="#part-2-source-and-target-size" class="table-of-contents__link toc-highlight">Part 2: Source and Target Size</a></li><li><a href="#part-3-instructions" class="table-of-contents__link toc-highlight">Part 3: Instructions</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Collaborate</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/i27ae15/git-protocol-doc" target="_blank" rel="noopener noreferrer" class="footer__link-item">Doc Repository<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Implementations</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/i27ae15/git" target="_blank" rel="noopener noreferrer" class="footer__link-item">Git<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div></div></footer></div>
</body>
</html>