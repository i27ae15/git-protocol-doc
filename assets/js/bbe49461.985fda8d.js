"use strict";(self.webpackChunkgit_protocol=self.webpackChunkgit_protocol||[]).push([[372],{4555:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>a,contentTitle:()=>c,default:()=>h,frontMatter:()=>s,metadata:()=>n,toc:()=>l});const n=JSON.parse('{"id":"git-protocol/git-upload","title":"2. Git-Upload Service","description":"At this point we have in our power, the sha1 that corresponds to the head pack file, now is time to request git to return it for us,","source":"@site/docs/git-protocol/git-upload.md","sourceDirName":"git-protocol","slug":"/git-protocol/git-upload","permalink":"/git-protocol-doc/docs/git-protocol/git-upload","draft":false,"unlisted":false,"editUrl":"https://github.com/i27ae15/git-protocol-doc/docs/git-protocol/git-upload.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3},"sidebar":"tutorialSidebar","previous":{"title":"1. Discovering References","permalink":"/git-protocol-doc/docs/git-protocol/discovering-references"},"next":{"title":"3. Pack Header","permalink":"/git-protocol-doc/docs/git-protocol/pack-header"}}');var i=o(4848),r=o(8453);const s={sidebar_position:3},c="2. Git-Upload Service",a={},l=[{value:"Important to note",id:"important-to-note",level:3}];function d(e){const t={code:"code",h1:"h1",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.header,{children:(0,i.jsx)(t.h1,{id:"2-git-upload-service",children:"2. Git-Upload Service"})}),"\n",(0,i.jsxs)(t.p,{children:["At this point we have in our power, the sha1 that corresponds to the head pack file, now is time to request git to return it for us,\nfor this we will use the ",(0,i.jsx)(t.code,{children:"git-upload"})," service."]}),"\n",(0,i.jsxs)(t.p,{children:["The way git works is by a simple ",(0,i.jsx)(t.code,{children:"want"})," - ",(0,i.jsx)(t.code,{children:"have"})," way of communicating, as simple as, we tell git what we ",(0,i.jsx)(t.code,{children:"want"})," and we must le it know\nwhat we already ",(0,i.jsx)(t.code,{children:"have"}),"."]}),"\n",(0,i.jsxs)(t.p,{children:["We make this request to ",(0,i.jsx)(t.code,{children:".git/git-upload-pack"})," where the body of the object will have the following structure:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:"C: 0032want <want #1>...............................\\x0A\nC: 0032want <want #2>...............................\\x0A\n....\nC: 0032have <have #1>...............................\\x0A\nC: 0032have <have #2>...............................\\x0A\n....\nC: 00000009 done\\x0A\n"})}),"\n",(0,i.jsx)(t.h3,{id:"important-to-note",children:"Important to note"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"Each line must be separated by a blank line."}),"\n",(0,i.jsxs)(t.li,{children:["The contest must be terminated by a blank line after the ",(0,i.jsx)(t.code,{children:"done"})," word."]}),"\n",(0,i.jsxs)(t.li,{children:["Content-type in the headers must be: ",(0,i.jsx)(t.code,{children:"Content-Type: application/x-git-upload-pack-request"}),"."]}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:"An example response looks like this:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:"0008NAK\\x0A\nPACKL\ufffdx\ufffd\ufffd\u0331n\ufffd \u041d\ufffd\ufffd\ufffdRt`\ufffdTU\ufffd2d\ufffd/\ufffd ...\n"})}),"\n",(0,i.jsx)(t.p,{children:"Where we get the pack file compressed with the z-lib algo."}),"\n",(0,i.jsxs)(t.p,{children:["if you are asking why the why do we ",(0,i.jsx)(t.code,{children:"NAK"})," if the communication was a succeed here is the answer:"]}),"\n",(0,i.jsxs)(t.p,{children:["The ",(0,i.jsx)(t.code,{children:"0008NAK"})," is part of the Git protocol's negotiation phase. It indicates that the server did not find any common commits between the client\nand the server for the requested references. This often happens during an initial clone or when the client doesn't have any objects yet."]}),"\n",(0,i.jsx)(t.p,{children:"At this point, we have all to start processing the pack file."})]})}function h(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,t,o)=>{o.d(t,{R:()=>s,x:()=>c});var n=o(6540);const i={},r=n.createContext(i);function s(e){const t=n.useContext(r);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function c(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),n.createElement(r.Provider,{value:t},e.children)}}}]);